(function(e){(function(e,s){s["true"]=e;String.prototype.times=function(e){return Array.prototype.join.call({length:e+1},this)};var t={tm:null,ui:{red:"#DD0000",org:"#DD5C00",blue:"#005FDD",grey:"#A1A1A1",cyan:"#00C4DD",green:"#06DD00",yellow:"#DDC100",purple:"#DD00A0",print:function(e,s){t.tm.echo("[[;"+(s||this.grey)+";]"+e+"]");t.base.down()},info:function(e){t.tm.echo("[[[;"+this.cyan+";]i]] [[;"+this.cyan+";]"+e+"]");t.base.down()},error:function(e){t.tm.echo("[[[;"+this.red+";]!]] [[;"+this.red+";]"+e+"]");t.base.down()},warning:function(e){t.tm.echo("[[[;"+this.org+";]*]] [[;"+this.org+";]"+e+"]");t.base.down()},success:function(e){t.tm.echo("[[[;"+this.green+";]+]] [[;"+this.green+";]"+e+"]");t.base.down()},usage:function(e,s){t.tm.echo("[[[;"+this.cyan+";]?]] [[;"+this.cyan+";]Usage]: "+"[[;"+this.green+";]"+e+"] "+"[[;"+this.yellow+";]"+s+"]");t.base.down()},example:function(e,s){t.tm.echo("[[[;"+this.org+";]*]] [[;"+this.org+";]Examp]: "+"[[;"+this.green+";]"+e+"] "+"[[;"+this.yellow+";]"+s+"]");t.base.down()},showPoc:function(e){var s=t.base.fstr("#ID",10);s+=t.base.fstr("#POC-ID",25);s+=t.base.fstr("#POC-COIN",10);s+=t.base.fstr("#POC-AUTHOR",15);s+=t.base.fstr("#POC-MODIFY",20);s+=t.base.fstr("#POC-NAME",40);t.tm.echo("[[;"+this.cyan+";]"+s+"]");t.tm.echo("[[;"+this.grey+";]"+"-".times(110)+"]");var a=1;for(var r in e){var i=t.base.fstr(a.toString(),10);i+="[[;"+this.yellow+";]"+t.base.fstr(r,25)+"]";i+=t.base.fstr(e[r].info.coin.toString(),10);i+=t.base.fstr(e[r].info.author,15);i+=t.base.fstr(e[r].info.modify,20);i+=t.base.fstr(e[r].info.name,40);t.tm.echo(i);a++}t.base.down()},showUser:function(e){this.info("Current user information");t.tm.echo(" ".times(4)+"[[;"+this.grey+";]"+"-".times(24)+"]");t.tm.echo(" ".times(4)+"[[;"+this.yellow+";]"+t.base.fstr("帐号",10)+"]"+"[[;"+this.green+";]"+e["name"]+"]");t.tm.echo(" ".times(4)+"[[;"+this.yellow+";]"+t.base.fstr("金币",10)+"]"+"[[;"+this.green+";]"+e["coin"]+"]");t.tm.echo(" ".times(4)+"[[;"+this.yellow+";]"+t.base.fstr("邮箱",10)+"]"+"[[;"+this.green+";]"+e["email"]+"]");t.tm.echo(" ".times(4)+"[[;"+this.yellow+";]"+t.base.fstr("博客",10)+"]"+"[[;"+this.green+";]"+e["blog"]+"]");t.base.down()},helpMenu:function(e,s){t.ui.info(e);t.tm.echo(" ".times(4)+"[[;"+t.ui.grey+";]"+"-".times(e.length)+"]");for(var a in s){t.tm.echo("    "+"[[;"+t.ui.green+";]"+t.base.fstr(a,10)+"][[;"+t.ui.yellow+";]"+s[a]+"]")}},hideCmd:function(){t.tm.pause()},showCmd:function(){t.tm.resume()},logo:function(){var e=this.red;return"		 ___      ___  [[;"+e+';] ________ ] ___________  \n		|"  \\    /"  |[[;'+e+';] /"       )]("     _   ") \n		 \\   \\  //   |[[;'+e+";](:   \\___/  ])__/  \\\\__/  \n		 /\\\\  \\/.    |[[;"+e+";] \\___  \\ ]      \\\\_ /     \n		|: \\.        | [[;"+e+";] __/  \\\\  ]    |.  |     \n		|.  \\    /:  | [[;"+e+';]/" \\   :)  ]   \\:  |     \n		|___|\\__/|___|[[;'+e+";](_______/    ]   \\__|     \n		                                       \n			"},desc:function(e){return"		[[;"+this.grey+";]----------+=>|] MST::[[;"+this.cyan+";]My Safe Tools]\n				[[;"+this.grey+";]---=>|] VER::[[;"+this.green+";]2.0]\n			[[;"+this.grey+";]--*---*=>|] POC::[[;"+this.yellow+";]"+(e||"??")+"]\n			"},user:function(e,s){return"[[;"+this.purple+";]"+e+"]@mst: [[;"+this.blue+";]"+(s||"~")+"] $ "}},base:{use:function(e){var s=document.createElement("script");s.type="text/javascript";s.onerror=function(s){e.error(s)};if(s.readyState){s.onreadystatechange=function(){if(["loaded","complete"].indexOf(s.readyState)>-1){e.success()}}}else{s.onload=function(){e.success()}}s.src=e.url||"";document.getElementsByTagName("head")[0].appendChild(s)},down:function(){$("html, body").animate({scrollTop:$(document).height()},100)},reload:function(e){if(t.tm.login_name()){t.tm.logout()}if(e){setTimeout('$("#cmd").remove();location.reload();',e);t.ui.info(e+"/ms后刷新..")}else{$("#cmd").remove();location.reload()}},fstr:function(e,s){return e.length>=s?e.substr(0,s-3)+".. ":e+" ".times(s-e.length)},bfb:function(e,s){return(Math.round(e/s*1e4)/100).toString()+"%"},xstr:function(e){return e?true:false},xint:function(e){return e?true:false},xpat:function(e){return e?true:false}},server:{socket:null,host:mst_config_server,send:function(e,s){this.socket.emit(e,s)}},pocs:[],curpoc:{},tasks:{}};$(document).ready(function(){$("html").css({"background-image":"url(../static/mst/img/bg"+Math.round(Math.random()*24)+".jpg)"});$(document).keydown(function(e){t.base.down()});window.onbeforeunload=function(){t.base.reload()};$(document).click(function(e){t.tm.focus()});t.tm=$("#cmd").terminal({},{exit:false,greetings:false,name:"login",prompt:"$"});t.ui.hideCmd();t.server.socket=io.connect(t.server.host);t.server.socket.on("connect",function(){t.ui.success("连接服务器成功!");t.ui.showCmd();t.tm.push({},{exit:false,name:"login",greetings:false,login:function(e,s,a){t.base.down();if(t.base.xstr(e)&&t.base.xstr(s)){t.ui.info("检测用户中..");t.ui.hideCmd();t.server.send("init",{user:e,pass:s});t.server.user=e;localStorage["mst_login_user"]=e;localStorage["mst_login_pass"]=s;t.server.login_callback=a}else{t.ui.warning("输入格式不正确!");t.base.reload(800)}}});if(t.base.xstr(localStorage["mst_login_user"])&&t.base.xstr(localStorage["mst_login_pass"])){t.server.send("init",{user:localStorage["mst_login_user"],pass:localStorage["mst_login_pass"]});t.server.user=localStorage["mst_login_user"];t.server.login_callback=function(){}}}).on("disconnect",function(){t.ui.hideCmd();t.ui.error("服务器断开连接..");localStorage["mst_login_pass"]=localStorage["mst_login_user"]="";t.base.reload(1e3)}).on("init",function(e){if(e.login){t.tm.clear();t.ui.showCmd();t.user=e.user;t.pocs=e.pocs;t.tasks=e.task||{};t.server.login_callback("SECRET TOKEN");var s=0;for(var a in t.pocs){s++}t.tm.echo(t.ui.logo());t.tm.echo(t.ui.desc(s));t.tm.push(function(e,s){t.base.down();var a=e.replace(/(^\s*)|(\s*$)/g,"");var r=a.split(" ");switch(r.length){case 1:switch(r[0]){case"clear":t.tm.clear();break;case"load":t.ui.usage("load","<POC-ID>");break;case"show":t.ui.usage("show","<pocs> | <user>");break;case"exit":case"quit":localStorage["mst_login_pass"]=localStorage["mst_login_user"]="";t.base.reload();break;case"task":t.tm.push(function(e,s){var a=e.replace(/(^\s*)|(\s*$)/g,"");var r=a.split(" ");switch(r[0]){case"help":t.ui.helpMenu("Task help menu",{add:"添加扫描任务",del:"删除扫描任务",list:"查看扫描任务列表",view:"查看扫描任务结果",quit:"返回主界面"});break;case"exit":case"quit":case"back":t.tm.pop();break;case"list":var i=t.base.fstr("#TASK-ID",10);i+=t.base.fstr("#CREATE-TIME",25);i+=t.base.fstr("#UPDATE-TIME",25);i+=t.base.fstr("#PROGRESS",15);t.tm.echo("[[;"+t.ui.cyan+";]"+i+"]");t.tm.echo("[[;"+t.ui.grey+";]"+"-".times(75)+"]");for(var o in t.tasks){var n=t.tasks[o];if(typeof n==="object"&&n!==null){var c="[[;"+t.ui.yellow+";]"+t.base.fstr(o.toString(),10)+"]";c+=t.base.fstr(n.time.create||"",25);c+=t.base.fstr(n.time.update||"-",25);c+="[[;"+t.ui.green+";]"+t.base.fstr(t.base.bfb(n.progress.now,n.progress.all)||"%??",15)+"]";t.tm.echo(c)}}break;case"view":if(r[1]){var n=t.tasks[parseInt(r[1])||0];if(typeof n==="object"&&n!==null){t.tm.echo("[[;"+t.ui.cyan+";]#TASK:INFO]");t.tm.echo("[[;"+t.ui.grey+";]----------]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("PROGRESS",15)+"]"+"[[;"+t.ui.green+";]"+t.base.bfb(n.progress.now,n.progress.all)+"]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("CREATE-TIME",15)+"]"+"[[;"+t.ui.green+";]"+n.time.create+"]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("UPDATE-TIME",15)+"]"+"[[;"+t.ui.green+";]"+n.time.update+"]");for(var u in n.scan){for(var l in n.scan[u]){var f=n.scan[u][l];if(r[2]&&r[2]!==f.res.toString()){continue}t.tm.echo("[[;"+t.ui.cyan+";]#TASK:"+u+":"+l+"]");t.tm.echo("[[;"+t.ui.grey+";]"+"-".times(u.length+7+l.toString().length)+"]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("OPTS.HOST",15)+"]"+"[[;"+t.ui.green+";]"+f.opt.host+"]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("OPTS.PATH",15)+"]"+"[[;"+t.ui.green+";]"+f.opt.path+"]");t.tm.echo(" ".times(5)+"[[;"+t.ui.yellow+";]"+t.base.fstr("OPTS.PORT",15)+"]"+"[[;"+t.ui.green+";]"+f.opt.port+"]");t.tm.echo(" ".times(5)+"[[;"+(f.res?t.ui.org:t.ui.grey)+";]"+t.base.fstr("TEST.RESULT",15)+"]"+"[[;"+(f.res?t.ui.org:t.ui.grey)+";]"+f.res+"]")}}}else{t.ui.warning("没有这个任务!")}}else{t.ui.usage("view","<TASK-ID> (true|false)")}break;case"del":if(t.base.xint(r[1])){var n=t.tasks[parseInt(r[1])||0];if(n.progress.all===n.progress.now){t.server.send("task",{act:"del",tid:parseInt(r[1])})}else{t.ui.warning("任务尚未扫描完成!")}}else{t.ui.usage("del","<TASK-ID>")}break;case"add":var m=[];var h=[];for(var u=1;u<r.length;u++){if(r[u]==="*"){for(var g in t.pocs){if(t.user.coin>=t.pocs[g].info.coin){m.push(g)}}}else if(r[u].indexOf("mst-")===0){if(t.user.coin>=t.pocs[r[u]].info.coin){m.push(r[u])}}};if(r.length>2){var p=r[r.length-1].split(",")||[];for(var u in p){var b=p[u].split(":")||[];b[0]=t.base.xstr(b[0])?b[0]:false;if(b[0]){h.push({host:b[0],port:parseInt(b[1])||80,path:b[2]||"/"})}else{t.ui.warning("格式输入有误("+b[0]+")!")}}};if(m.length>0&&h.length>0){t.server.send("task",{act:"add",poc:m,opt:h});t.ui.hideCmd()}else{t.ui.usage("add","<TASK-POCS> <TASK-OPTS>");t.ui.example("add","* 1.2.3.4:8080:/manager/");t.ui.example("add","mst-xxx-01 mst-ooo-02 mst.3asec.com,www.baidu.com:80:/,test.com:443:/admin/")}break;default:break}t.base.down()},{name:"task",exit:false,prompt:t.ui.user(t.server.user,"task"),greetings:false,completion:function(e,s,a){t.base.down();var r=e.get_command();var i=r.split(" ");if(i[0]==="add"){var o=["*"];for(var n in t.pocs){if(t.user.coin>=t.pocs[n].info.coin){o.push(n)}}a(o)}switch(i.length){case 1:a(["help","back","exit","quit","list","view","add","del"]);break;case 2:switch(i[0]){case"del":case"view":var o=[];for(var c in t.tasks){if(c!=="count"&&t.tasks[c]!==null){o.push(c)}};a(o);break;default:break}break;case 3:if(i[0]==="view"){a(["true","false"])};break;default:break}}});break;case"search":t.ui.usage("search","<keyword>");break;case"history":t.ui.info("History commands");t.tm.echo(" ".times(4)+"[[;"+t.ui.grey+";]"+"-".times(16)+"]");var i=t.tm.history().data();for(var o=1;o<i.length;o++){t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr(o.toString(),5)+"]"+i[o])};break;case"help":t.ui.helpMenu("Main help menu",{gui:"切换到GUI界面",help:"显示帮助菜单",quit:"注销用户登录",show:"显示漏洞库列表或者用户信息",load:"加载漏洞测试",task:"扫描任务管理",blog:"修改用户博客地址",clear:"清空屏幕(快捷键CTRL+L)",email:"修改用户邮箱",search:"搜索漏洞库",history:"用户输入历史命令",password:"修改用户密码"});break;case"email":t.ui.usage("email","<new email>");break;case"password":t.ui.usage("password","<new password>");break;case"blog":t.ui.usage("blog","<new blog>");break;case"gui":location.href="/gui/";break;default:break};break;case 2:var n=r[1];var c=/^[a-zA-Z0-9\.@]+$/;switch(r[0]){case"load":if(t.pocs[n]){t.curpoc=t.pocs[n];t.curpoc.name=n;t.tm.push(function(e,s){t.base.down();var a=e.replace(/(^\s*)|(\s*$)/g,"");var r=a.split(" ");switch(r.length){case 1:switch(r[0]){case"show":t.ui.usage("show","<options> | <info>");break;case"help":t.ui.helpMenu("Poc help menu",{set:"设置扫描参数",test:"开始进行测试",show:"显示漏洞信息参数",back:"返回主菜单",help:"显示帮助菜单",clear:"清空屏幕",verify:"开始进行测试"});break;case"exit":case"quit":case"back":t.tm.pop();break;case"set":t.ui.usage("set","<option> <value>");break;case"clear":t.tm.clear();break;case"verify":case"test":if(t.user.coin>=t.curpoc.info.coin){t.ui.hideCmd();t.ui.info("等待测试结果..");t.server.send("test",{name:t.curpoc.name,opts:t.curpoc.opts})}else{t.ui.warning("你的金币不足以使用该POC!");t.tm.pop()}break;default:break};break;case 2:var i=r[1];switch(r[0]){case"show":if(i=="options"){t.ui.info("POC optioins");t.tm.echo(" ".times(4)+"[[;"+t.ui.grey+";]"+"-".times(12)+"]");for(var o in t.curpoc.opts){t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr(o,10)+"]"+"[[;"+t.ui.green+";]"+t.curpoc.opts[o]+"]")}}else if(i=="info"){t.ui.info("POC infomations");t.tm.echo(" ".times(4)+"[[;"+t.ui.grey+";]"+"-".times(14)+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("漏洞价值",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["coin"]+" 金币]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("漏洞名称",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["name"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("漏洞简介",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["desc"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("提交时间",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["modify"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("提交作者",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["author"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("作者邮箱",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["author_eml"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("作者博客",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["author_web"]+"]");t.tm.echo(" ".times(4)+"[[;"+t.ui.yellow+";]"+t.base.fstr("参考链接",10)+"][[;"+t.ui.green+";]"+t.curpoc.info["reference"].split(",").join("	")+"]")}else{}break;default:break}break;case 3:var n=r[1];var i=r[2];switch(r[0]){case"set":if(t.curpoc.opts[n]!==undefined){t.curpoc.opts[n]=i}else{t.ui.warning("Not this parameter!")}break;default:break}default:break}},{name:"poc",exit:false,prompt:t.ui.user(t.server.user,r[1]),greetings:false,completion:function(e,s,a){t.base.down();var r=e.get_command();var i=r.split(" ");switch(i.length){case 1:a(["help","show","quit","set","back","clear","test","verify"]);break;case 2:switch(i[0]){case"show":a(["options","info"]);break;case"set":var o=[];for(var n in t.curpoc.opts){o.push(n)};a(o);break;default:break}break;default:break}}})}else{t.ui.warning("木有此POC!")}break;case"show":switch(r[0]){case"show":if(n=="pocs"){t.ui.showPoc(t.pocs)}else if(n=="user"){t.ui.showUser(t.user)}else{t.ui.usage("show","<pocs> | <user>")};break;default:break}break;case"search":var u={};for(_poc in t.pocs){if(_poc.indexOf(n)!=-1||t.pocs[_poc].info.name.indexOf(n)!=-1||t.pocs[_poc].info.desc.indexOf(n)!=-1){u[_poc]=t.pocs[_poc]}};t.ui.showPoc(u);break;case"history":if(n==="clear"){t.tm.history().clear()};break;case"email":if(t.base.xstr(r[1])){t.server.send("user",{act:"update",email:r[1]})}else{t.ui.warning("只允许输入字母数字以及(.@)符号!")}break;case"blog":t.server.send("user",{act:"update",blog:r[1]});break;case"password":if(t.base.xstr(r[1])){t.server.send("user",{act:"update",pass:r[1]})}else{t.ui.warning("只允许输入字母数字以及(.@)符号!")}break;default:break}break;default:break}},{name:"main",exit:false,prompt:t.ui.user(t.server.user),greetings:false,completion:function(e,s,a){t.base.down();var r=e.get_command();var i=r.split(" ");switch(i.length){case 1:a(["help","quit","clear","show","load","task","gui","search","email","blog","password","history"]);break;case 2:switch(i[0]){case"load":var o=[];for(var n in t.pocs){o.push(n)}a(o);break;case"show":a(["pocs","user"]);break;case"history":a(["clear"]);break;default:break}break;default:break}}})}else{localStorage["mst_login_user"]=localStorage["mst_login_pass"]="";t.ui.warning("登录失败！");t.base.reload(800)}}).on("test",function(e){if(e.result==true){t.ui.success("存在漏洞!");if(t.pocs[e.name].info.fix!=""){t.ui.warning("修复方案: "+t.pocs[e.name].info.fix)}}else{t.ui.error("漏洞不存在!")}t.ui.showCmd()}).on("task",function(e){t.ui.showCmd();switch(e.act){case"add":if(e.add){t.ui.success("任务添加成功! ID="+e.tid);t.tasks=e.task||{}}else{t.ui.warning("任务添加失败!")}break;case"del":if(e.del){t.ui.success("任务删除成功! ID="+e.tid);t.tasks=e.task||{}}else{t.ui.warning("任务删除失败!")}break;case"res":var s=e.res;t.tasks[s.info.id]=s;if(s.progress.now===s.progress.all){t.ui.info("任务("+e.res.info.id+")扫描完成!")};break;default:break}}).on("user",function(e){switch(e.act){case"update":if(e.msg===true){t.user=e.row;t.ui.success("更改用户信息成功!")}else{t.ui.error("更改用户信息失败!("+e.msg+")")}break;default:break}}).on("reconnecting",function(){t.ui.error("无法连接服务器 :(")})})})({},function(){return this}())})();
//# sourceMappingURL=console.min.map